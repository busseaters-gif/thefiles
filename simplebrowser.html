<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web Viewer</title>

<style>
html, body {
  margin: 0;
  height: 100%;
  background: #0f2027;
  font-family: "Segoe UI", Tahoma, sans-serif;
  color: white;
}

.app {
  display: flex;
  flex-direction: column;
  height: 100%;
}

header {
  background: #121212;
  padding: 10px;
  display: flex;
  gap: 8px;
  align-items: center;
}

input, select, button {
  padding: 8px 10px;
  border-radius: 6px;
  border: none;
  background: #1e1e1e;
  color: white;
}

button {
  background: linear-gradient(135deg,#00c6ff,#0072ff);
  cursor: pointer;
  font-weight: 600;
}

#warning {
  display: none;
  background: #ff9800;
  color: #000;
  padding: 6px 10px;
  font-size: 13px;
}

#loading {
  display: none;
  text-align: center;
  padding: 6px;
  font-weight: 600;
}

iframe, pre {
  flex: 1;
  width: 100%;
  border: none;
  background: white;
  color: black;
}

pre {
  margin: 0;
  padding: 10px;
  overflow: auto;
}

input#url {
  flex: 1; 
  min-width: 0;
}
</style>
</head>

<body>
<div class="app">

<header>
  <input id="url" placeholder="Enter URL" size="40" value="home://home">
  <select id="mode">
    <option value="direct">Direct</option>
    <option value="preview">Prox</option>
    <option value="source">Source</option>
  </select>
  <button onclick="go()">Go</button>
</header>

<div id="warning"></div>
<div id="loading">Loading…</div>

<iframe id="view" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
<pre id="source" style="display:none"></pre>

</div>

<script>
const iframe = document.getElementById("view");
const source = document.getElementById("source");
const loading = document.getElementById("loading");
const warning = document.getElementById("warning");

function showLoading(on) {
  loading.style.display = on ? "block" : "none";
}

function showWarning(msg) {
  warning.textContent = "⚠️ " + msg;
  warning.style.display = "block";
}

function clearUI() {
  warning.style.display = "none";
  iframe.style.display = "block";
  source.style.display = "none";
}

function normalize(url) {
  if (url === "home://home") return url;
  if (!url.startsWith("http")) return "https://" + url;
  return url;
}


function loadHome() {
  iframe.src = "";
  iframe.srcdoc = `
    <html>
    <head>
      <style>
        html, body {
          margin: 0;
          height: 100%;
          font-family: sans-serif;
          background: #121212;
          color: white;
          display: flex;
          flex-direction: column;
        }

        h1 { margin-top: 20px; text-align: center; }
        p { text-align: center; margin-top: 0; }

        .middle {
          flex: 1;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .middle img {
          max-width: 50%;
          max-height: 50%;
        }

        .bottom-info {
          padding: 20px;
          font-size: 14px;
          line-height: 1.6;
        }

        ul { line-height: 1.6; }
        h3 { margin-bottom: 4px; }
      </style>
    </head>
    <body>
      <h1>Welcome to my homemade proxy</h1>
      <p>This is a lightweight proxy</p>
      <p>Start searching!</p>

      <div class="middle">
        <img src="https://lh7-rt.googleusercontent.com/sitesz/AClOY7rD2RDE5-DnEZ1JoBEP_p8J9dI1067sx9qHmmBYdHSBrprfxyRUrhr8DUaHfp3X1SCZSpG4BgkcVCNKDaKi0SUTgi06eqf07FPu3EgVHm5rlRquoIBHakFRL4-8UXu8kh2g1hE7IPQqsuyg8_Va8UkEwWPQdz3nIYX5WWaVeiZh01PEoASQ?key=cKilh5eis4aTSZZPjinrOA" alt="Domer">
      </div>

      <div class="bottom-info">
        <h3>Modes</h3>
        <ul>
          <li><b>Direct</b> – Best rendering, most likely blocked</li>
          <li><b>Preview</b> – Loads all sites (with limits)</li>
          <li><b>Source</b> – View raw HTML</li>
        </ul>

        <h3>Limitations</h3>
        <ul>
          <li>Login/large sites may not work on direct mode</li>
          <li>Some scripts/styles may not load on the proxy (because it’s lightweight)</li>
        </ul>

        <h3>Tips/Tricks</h3>
        <ul>
          <li>Add ?igu=1 after Google URL to make it load on direct (easter egg)</li>
        </ul>
      </div>
    </body>
    </html>
  `;
}





function loadDirect(url) {
  iframe.removeAttribute("srcdoc");
  showLoading(true);
  iframe.onload = () => {
    showLoading(false);
  };
  iframe.src = url;
}



function loadPreview(url) {
  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
    .then(r => r.json())
    .then(d => {
      let html = d.contents;

      if (html.includes("Content-Security-Policy")) {
        showWarning("This site uses strict security. Preview may be limited.");
      }

      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      doc.querySelectorAll(
        'meta[http-equiv="Content-Security-Policy"]'
      ).forEach(m => m.remove());

      const base = doc.createElement("base");
      base.href = url;
      doc.head.prepend(base);
      iframe.src = "";
      iframe.srcdoc = "<!DOCTYPE html>" + doc.documentElement.outerHTML;
      showLoading(false);
    })
    .catch(() => {
      showWarning("Failed to load preview.");
      showLoading(false);
    });
}


function loadSource(url) {
  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
    .then(r => r.json())
    .then(d => {
      iframe.style.display = "none";
      source.style.display = "block";
      source.textContent = d.contents;
      showLoading(false);
    })
    .catch(() => {
      showWarning("Failed to load source.");
      showLoading(false);
    });
}

function go() {
  clearUI();
  showLoading(true);

  let url = normalize(document.getElementById("url").value.trim());
  let mode = document.getElementById("mode").value;

  if (!url || url === "home://home") {
    loadHome();
    showLoading(false);
    return;
  }

  if (mode === "direct") loadDirect(url);
  if (mode === "preview") loadPreview(url);
  if (mode === "source") loadSource(url);
}

loadHome();
</script>
</body>
</html>
